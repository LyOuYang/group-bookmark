# 产品演进路线图｜GroupBookmarks 跨 IDE 支持

## 文档信息

**项目名称**：GroupBookmarks - 分组书签工具  
**文档版本**：v1.0  
**创建日期**：2026-02-03  
**策略**：分阶段实现（方案 C）  
**关联文档**：[架构设计](./architecture.md) | [PRD 终版](./prd_final.md)

---

## 1. 演进策略概述

### 1.1 核心理念

> **先验证，再扩展**：在单一平台验证产品价值后，再投入跨平台开发。

**关键原则**：
- ✅ **数据层通用设计**：从 V1.0 开始就保证数据格式跨 IDE 兼容
- ✅ **风险最小化**：避免在需求未验证前过度投资
- ✅ **快速迭代**：先在 VS Code 平台快速发布，获取用户反馈
- ✅ **架构可扩展**：预留扩展点，降低未来迁移成本

---

### 1.2 演进路径

```
V1.0 (VS Code MVP)         V1.5 (IDEA 支持)          V2.0 (生态完善)
      ↓                          ↓                         ↓
   2-3 周                     6-8 周                    持续迭代
      ↓                          ↓                         ↓
  ┌─────────┐              ┌─────────┐              ┌─────────┐
  │单平台验证│  用户反馈好  │跨平台扩展│  数据打通    │生态成熟  │
  │数据通用 │ ──────────►  │UI 重写  │ ──────────► │云同步   │
  │核心功能 │              │双端维护 │              │团队协作 │
  └─────────┘              └─────────┘              └─────────┘
```

---

## 2. 版本规划详解

### V1.0：VS Code MVP（当前阶段）

#### 目标

**核心目标**：在 VS Code 平台验证产品价值，获取用户反馈

**成功指标**：
- ✅ 发布到 VS Code Marketplace
- ✅ 获得 100+ 用户安装
- ✅ 收集用户反馈，验证核心功能需求

---

#### 功能范围

**必须实现**：
- [x] 分组管理（CRUD + 颜色）
- [x] 书签管理（多对多关系）
- [x] Gutter 装饰器（可视化标记）
- [x] 拖拽排序（自定义 / 按名称）
- [x] 导入 / 导出（**数据格式通用化**）
- [x] 文件重命名跟踪

**技术栈**：
- 语言：TypeScript ^5.3.0
- 打包：esbuild
- 存储：JSON 文件（`.vscode/groupbookmarks/`）
- API：VS Code Extension API

---

#### 数据格式设计（为跨 IDE 预留）

**关键设计决策**：

| 设计点       | 实现方式                 | 跨 IDE 兼容性 |
| ------------ | ------------------------ | ------------- |
| **路径存储** | 相对路径 + `/` 分隔符    | ✅ 完全兼容    |
| **ID 生成**  | UUID v4（平台无关）      | ✅ 完全兼容    |
| **颜色定义** | HEX 色值（如 `#FF6B6B`） | ✅ 完全兼容    |
| **时间戳**   | Unix 时间戳（毫秒）      | ✅ 完全兼容    |

**导出格式示例**：

```json
{
  "version": "1.0.0",
  "platform": "vscode",      // 标识导出来源（可选）
  "workspace": "MyProject",
  "exportedAt": "2026-02-03T22:30:00Z",
  "bookmarks": [
    {
      "id": "uuid-1",
      "fileUri": "src/user.ts",  // ← 相对路径
      "line": 12,
      "column": 0,
      "createdAt": 1706979600000
    }
  ],
  "groups": [...],
  "relations": [...]
}
```

**兼容性保证**：IntelliJ IDEA 插件可以直接导入此 JSON，无需转换。

---

#### 时间线

| 周次   | 里程碑                                          |
| ------ | ----------------------------------------------- |
| Week 1 | 完成核心业务层（BookmarkManager, GroupManager） |
| Week 2 | 完成 UI 层（TreeView, Decoration）              |
| Week 3 | 完成导入导出 + 测试 + 发布                      |

---

### V1.1 - V1.4：VS Code 功能迭代

#### 目标

**基于用户反馈优化 VS Code 版本**

**可能的迭代方向**（根据用户反馈决定）：

| 版本     | 功能                           | 优先级 |
| -------- | ------------------------------ | ------ |
| **V1.1** | 书签笔记（Markdown 支持）      | P1     |
| **V1.2** | 全局搜索书签                   | P1     |
| **V1.3** | 统计面板（使用频率、最近访问） | P2     |
| **V1.4** | 快捷键优化 + 性能调优          | P1     |

**时间线**：每个版本 1-2 周

---

#### 决策点：是否启动 IDEA 版本？

**触发条件**（满足以下任一条件）：

1. **用户需求明确**
   - 收到 20+ 用户明确要求 IDEA 版本
   - 社区投票显示 60%+ 用户使用 IDEA

2. **VS Code 版本稳定**
   - 核心功能无重大 bug
   - 用户评分 ≥ 4.5 星

3. **资源充足**
   - 有足够时间投入（6-8 周）
   - 愿意维护双平台代码

**如果不满足条件**：继续深化 VS Code 功能（V1.5 → 书签协作、云同步等）

---

### V1.5：IntelliJ IDEA 支持（条件触发）

#### 目标

**扩展到 IntelliJ IDEA 平台，覆盖更多用户**

**成功指标**：
- ✅ 发布到 JetBrains Marketplace
- ✅ IDEA 版本与 VS Code 版本功能对齐
- ✅ 数据可在两平台无缝导入导出

---

#### 技术实现

**开发语言**：Java 17 / Kotlin

**核心模块重写**：

| 模块            | VS Code 实现         | IDEA 实现            | 复用率                       |
| --------------- | -------------------- | -------------------- | ---------------------------- |
| **数据层**      | JSON 读写（Node.js） | JSON 读写（Jackson） | **0%**（逻辑相同，代码重写） |
| **业务层**      | TypeScript 类        | Java/Kotlin 类       | **0%**（逻辑复用，代码重写） |
| **UI 层**       | TreeView + QuickPick | ToolWindow + Dialog  | **0%**（完全不同）           |
| **Gutter 装饰** | Decoration API       | GutterIconRenderer   | **0%**（API 不同）           |

**复用资源**：
- ✅ **数据格式**：100% 复用（JSON 定义相同）
- ✅ **业务逻辑**：概念复用（需翻译为 Java/Kotlin）
- ✅ **测试用例**：逻辑复用（需重写为 JUnit）

---

#### 关键技术挑战

**挑战 1：行号跟踪机制**

**VS Code**：
```typescript
// Decoration API 自动跟踪
const range = new vscode.Range(line, 0, line, 0);
editor.setDecorations(decoration, [range]);
```

**IDEA**：
```java
// 需要监听 Document 变更并手动更新
document.addDocumentListener(new DocumentListener() {
  @Override
  public void documentChanged(DocumentEvent event) {
    // 计算行号偏移并更新书签
  }
});
```

**解决方案**：使用 IDEA 的 `RangeMarker` API（类似 VS Code 的 Decoration）

---

**挑战 2：TreeView 拖拽**

**VS Code**：
```typescript
// TreeDragAndDropController
class BookmarkTreeProvider implements TreeDragAndDropController { ... }
```

**IDEA**：
```java
// 使用 DnDSupport
DnDSupport.createBuilder(myTree)
  .setBeanProvider(context -> new DnDDragStartBean(...))
  .install();
```

**解决方案**：参考 JetBrains 官方示例实现

---

#### 时间线

| 周次     | 里程碑                                |
| -------- | ------------------------------------- |
| Week 1-2 | 学习 IntelliJ Platform SDK + 环境搭建 |
| Week 3-4 | 实现数据层 + 业务层                   |
| Week 5-6 | 实现 UI 层（ToolWindow + Gutter）     |
| Week 7   | 测试 + 数据导入导出兼容性验证         |
| Week 8   | 发布到 JetBrains Marketplace          |

---

### V2.0：生态完善（长期愿景）

#### 目标

**打造跨 IDE 的分组书签生态**

**功能愿景**：

1. **云同步**
   - 基于 GitHub Gist 或私有云存储
   - 自动同步书签数据到云端
   - 多设备实时同步

2. **团队协作**
   - 只读模式：分享书签给团队成员
   - 评论功能：在书签上添加讨论
   - 权限管理：公开 / 团队 / 私有

3. **AI 辅助**
   - 智能分组建议（基于代码语义分析）
   - 自动生成书签标题（基于代码注释）

4. **其他 IDE 支持**
   - Sublime Text
   - Vim/Neovim（通过插件）

---

#### 架构升级

**从本地存储到云端架构**：

```
┌──────────────────────────────────────────┐
│         客户端（VS Code / IDEA）          │
│  ├─ 本地数据层（JSON）                     │
│  ├─ 同步引擎（Sync Service）              │
│  └─ 业务层 + UI 层                        │
└─────────────┬────────────────────────────┘
              │ HTTPS / WebSocket
              ↓
┌──────────────────────────────────────────┐
│            云端服务（可选）                │
│  ├─ API 网关                              │
│  ├─ 数据存储（PostgreSQL / S3）          │
│  ├─ 认证服务（OAuth）                     │
│  └─ 协作服务（实时同步）                  │
└──────────────────────────────────────────┘
```

---

## 3. 数据兼容性保证

### 3.1 跨 IDE 数据迁移

**场景 1：VS Code → IDEA**

```bash
# 用户在 VS Code 导出
File > Export Bookmarks > bookmarks_export.json

# 在 IDEA 导入
Tools > Import Bookmarks > 选择 bookmarks_export.json
```

**自动处理**：
- 路径分隔符转换（`/` 在两平台通用）
- 颜色值直接复用（HEX 格式）
- UUID 保持不变（保证唯一性）

---

**场景 2：IDEA → VS Code**

流程相同，完全对称。

---

### 3.2 版本兼容性

**向后兼容策略**：

```typescript
// 数据加载时版本检测
function loadData(filePath: string): BookmarkData {
  const raw = JSON.parse(fs.readFileSync(filePath, 'utf-8'));
  
  if (raw.version === '1.0.0') {
    return raw as BookmarkData;
  } else if (raw.version === '0.9.0') {
    // 迁移旧版本数据
    return migrateFrom_0_9_to_1_0(raw);
  } else {
    throw new Error(`不支持的数据版本: ${raw.version}`);
  }
}
```

**破坏性变更策略**（V2.0+）：
- 提供数据迁移工具
- 保留 1 个大版本的兼容性（如 V2.0 支持导入 V1.x 数据）

---

## 4. 风险控制

### 4.1 技术风险

| 风险                    | 影响       | 应对措施                         |
| ----------------------- | ---------- | -------------------------------- |
| **IDEA SDK 学习曲线陡** | 延迟上线   | 预留 2 周学习时间 + 参考官方示例 |
| **跨平台 UI 差异大**    | 体验不一致 | 保持功能对齐，UI 遵循各平台规范  |
| **数据格式不兼容**      | 迁移失败   | V1.0 阶段严格测试导入导出        |

---

### 4.2 市场风险

| 风险                  | 应对措施                                 |
| --------------------- | ---------------------------------------- |
| **IDEA 用户需求不足** | 通过社区调研 + 用户投票决定是否启动 V1.5 |
| **竞品出现**          | 快速迭代，强化差异化功能（多视角分组）   |

---

### 4.3 资源风险

| 风险                 | 应对措施                                 |
| -------------------- | ---------------------------------------- |
| **双平台维护成本高** | 优先保证 VS Code 版本稳定，IDEA 版本延后 |
| **团队规模限制**     | 寻找开源贡献者（如果开源）               |

---

## 5. 决策检查点

### 检查点 1：是否启动 V1.5（IDEA 版本）？

**时间节点**：V1.0 发布后 2-3 个月

**决策依据**：

```
┌─────────────────────────────────────┐
│ 用户需求量 ≥ 20 个明确请求？        │
│          ↓ YES                      │
│ VS Code 版本稳定（评分 ≥ 4.5）？    │
│          ↓ YES                      │
│ 有足够开发时间（6-8 周）？          │
│          ↓ YES                      │
│   → 启动 IDEA 版本开发              │
│          ↓ NO                       │
│   → 继续优化 VS Code 功能           │
└─────────────────────────────────────┘
```

---

### 检查点 2：是否启动 V2.0（云同步）？

**时间节点**：V1.5 发布后 6 个月

**决策依据**：
- 用户基数 ≥ 1000
- 用户反馈需要团队协作功能
- 有服务器运维能力或预算

---

## 6. 技术准备清单

### V1.0 阶段（当前）

- [x] 数据格式设计（通用化）
- [x] 路径处理策略（相对路径 + `/` 分隔符）
- [x] 导入导出功能实现
- [ ] 跨平台导入测试（手动验证路径兼容性）

---

### V1.5 阶段（IDEA 支持）

- [ ] 学习 IntelliJ Platform SDK
- [ ] 搭建 IDEA 插件开发环境
- [ ] 实现 IDEA 版本核心功能
- [ ] 跨 IDE 数据导入导出自动化测试

---

### V2.0 阶段（云同步）

- [ ] 设计云端 API（RESTful / GraphQL）
- [ ] 选择云存储方案（GitHub Gist / AWS S3）
- [ ] 实现同步引擎
- [ ] 冲突解决策略设计

---

## 7. 成功指标

### V1.0 成功标准

- ✅ VS Code Marketplace 上架
- ✅ 下载量 ≥ 100
- ✅ 用户评分 ≥ 4.0 星
- ✅ 收集到 ≥ 10 条有效反馈

---

### V1.5 成功标准

- ✅ JetBrains Marketplace 上架
- ✅ IDEA 版本与 VS Code 版本功能对齐
- ✅ 数据导入导出成功率 ≥ 95%
- ✅ 合计用户数 ≥ 500

---

### V2.0 成功标准

- ✅ 云同步功能稳定运行
- ✅ 团队协作功能被 ≥ 50 个团队使用
- ✅ 跨 IDE 用户占比 ≥ 30%

---

## 8. 关键里程碑

```
2026-02    2026-04    2026-08    2027-02
  │          │          │          │
  ├─ V1.0   ├─ V1.2    ├─ V1.5    ├─ V2.0
  │  发布   │  优化    │  IDEA    │  云同步
  │         │          │  版本    │
  │         │          │          │
  ▼         ▼          ▼          ▼
MVP 验证  用户增长  跨平台扩展  生态完善
```

---

## 9. 附录：技术调研资源

### IntelliJ IDEA 插件开发

**官方文档**：
- https://plugins.jetbrains.com/docs/intellij/welcome.html

**示例插件**：
- Bookmarks 类似插件：https://github.com/JetBrains/intellij-community（搜索 bookmark）

**开发环境**：
- IntelliJ IDEA Community Edition
- Plugin DevKit

---

### 云同步技术选型

| 方案                | 优点                 | 缺点                 |
| ------------------- | -------------------- | -------------------- |
| **GitHub Gist**     | 免费、简单、版本控制 | 受限于 GitHub 可用性 |
| **AWS S3 + Lambda** | 灵活、可扩展         | 需要运维、有成本     |
| **自建服务器**      | 完全可控             | 开发 + 运维成本高    |

**推荐**：V2.0 初期使用 GitHub Gist（免费 + 简单）

---

## 10. 总结

### 核心策略

> **先做精，再做广**

1. **V1.0**：聚焦 VS Code，做出优秀的单平台产品
2. **V1.5**：响应用户需求，扩展到 IDEA
3. **V2.0**：构建生态，提供云同步和协作

### 关键成功因素

- ✅ **数据通用性**：从一开始就设计跨平台兼容的数据格式
- ✅ **用户反馈驱动**：基于真实需求决定是否扩展平台
- ✅ **渐进式投入**：避免过度设计，降低风险

---

**文档版本**：v1.0  
**最后更新**：2026-02-03  
**维护者**：技术架构师
